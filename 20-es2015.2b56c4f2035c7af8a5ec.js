(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{FAoz:function(t,e,i){!function(){function e(t){return Math.sqrt(t.x*t.x+t.y*t.y)}var i=function(t){this.handlers=[],this.el=t};function n(t,e){var n=new i(t);return n.add(e),n}i.prototype.add=function(t){this.handlers.push(t)},i.prototype.del=function(t){t||(this.handlers=[]);for(var e=this.handlers.length;e>=0;e--)this.handlers[e]===t&&this.handlers.splice(e,1)},i.prototype.dispatch=function(){for(var t=0,e=this.handlers.length;t<e;t++){var i=this.handlers[t];"function"==typeof i&&i.apply(this.el,arguments)}};var s=function(t,e){this.element="string"==typeof t?document.querySelector(t):t,this.start=this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.cancel=this.cancel.bind(this),this.element.addEventListener("touchstart",this.start,!1),this.element.addEventListener("touchmove",this.move,!1),this.element.addEventListener("touchend",this.end,!1),this.element.addEventListener("touchcancel",this.cancel,!1),this.preV={x:null,y:null},this.pinchStartLen=null,this.zoom=1,this.isDoubleTap=!1;var i=function(){};this.rotate=n(this.element,e.rotate||i),this.touchStart=n(this.element,e.touchStart||i),this.multipointStart=n(this.element,e.multipointStart||i),this.multipointEnd=n(this.element,e.multipointEnd||i),this.pinch=n(this.element,e.pinch||i),this.swipe=n(this.element,e.swipe||i),this.tap=n(this.element,e.tap||i),this.doubleTap=n(this.element,e.doubleTap||i),this.longTap=n(this.element,e.longTap||i),this.singleTap=n(this.element,e.singleTap||i),this.pressMove=n(this.element,e.pressMove||i),this.twoFingerPressMove=n(this.element,e.twoFingerPressMove||i),this.touchMove=n(this.element,e.touchMove||i),this.touchEnd=n(this.element,e.touchEnd||i),this.touchCancel=n(this.element,e.touchCancel||i),this._cancelAllHandler=this.cancelAll.bind(this),window.addEventListener("scroll",this._cancelAllHandler),this.delta=null,this.last=null,this.now=null,this.tapTimeout=null,this.singleTapTimeout=null,this.longTapTimeout=null,this.swipeTimeout=null,this.x1=this.x2=this.y1=this.y2=null,this.preTapPosition={x:null,y:null}};s.prototype={start:function(t){if(t.touches){this.now=Date.now(),this.x1=t.touches[0].pageX,this.y1=t.touches[0].pageY,this.delta=this.now-(this.last||this.now),this.touchStart.dispatch(t,this.element),null!==this.preTapPosition.x&&(this.isDoubleTap=this.delta>0&&this.delta<=250&&Math.abs(this.preTapPosition.x-this.x1)<30&&Math.abs(this.preTapPosition.y-this.y1)<30,this.isDoubleTap&&clearTimeout(this.singleTapTimeout)),this.preTapPosition.x=this.x1,this.preTapPosition.y=this.y1,this.last=this.now;var i=this.preV;if(t.touches.length>1){this._cancelLongTap(),this._cancelSingleTap();var n={x:t.touches[1].pageX-this.x1,y:t.touches[1].pageY-this.y1};i.x=n.x,i.y=n.y,this.pinchStartLen=e(i),this.multipointStart.dispatch(t,this.element)}this._preventTap=!1,this.longTapTimeout=setTimeout((function(){this.longTap.dispatch(t,this.element),this._preventTap=!0}).bind(this),750)}},move:function(t){if(t.touches){var i=this.preV,n=t.touches.length,s=t.touches[0].pageX,o=t.touches[0].pageY;if(this.isDoubleTap=!1,n>1){var a=t.touches[1].pageX,r=t.touches[1].pageY,c={x:t.touches[1].pageX-s,y:t.touches[1].pageY-o};null!==i.x&&(this.pinchStartLen>0&&(t.zoom=e(c)/this.pinchStartLen,this.pinch.dispatch(t,this.element)),t.angle=(u=function(t,i){var n=e(t)*e(i);if(0===n)return 0;var s=function(t,e){return t.x*e.x+t.y*e.y}(t,i)/n;return s>1&&(s=1),Math.acos(s)}(d=c,g=i),function(t,e){return t.x*e.y-e.x*t.y}(d,g)>0&&(u*=-1),180*u/Math.PI),this.rotate.dispatch(t,this.element)),i.x=c.x,i.y=c.y,null!==this.x2&&null!==this.sx2?(t.deltaX=(s-this.x2+a-this.sx2)/2,t.deltaY=(o-this.y2+r-this.sy2)/2):(t.deltaX=0,t.deltaY=0),this.twoFingerPressMove.dispatch(t,this.element),this.sx2=a,this.sy2=r}else{if(null!==this.x2){t.deltaX=s-this.x2,t.deltaY=o-this.y2;var h=Math.abs(this.x1-this.x2),l=Math.abs(this.y1-this.y2);(h>10||l>10)&&(this._preventTap=!0)}else t.deltaX=0,t.deltaY=0;this.pressMove.dispatch(t,this.element)}this.touchMove.dispatch(t,this.element),this._cancelLongTap(),this.x2=s,this.y2=o,n>1&&t.preventDefault()}var d,g,u},end:function(t){if(t.changedTouches){this._cancelLongTap();var e=this;t.touches.length<2&&(this.multipointEnd.dispatch(t,this.element),this.sx2=this.sy2=null),this.x2&&Math.abs(this.x1-this.x2)>30||this.y2&&Math.abs(this.y1-this.y2)>30?(t.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout((function(){e.swipe.dispatch(t,e.element)}),0)):(this.tapTimeout=setTimeout((function(){e._preventTap||e.tap.dispatch(t,e.element),e.isDoubleTap&&(e.doubleTap.dispatch(t,e.element),e.isDoubleTap=!1)}),0),e.isDoubleTap||(e.singleTapTimeout=setTimeout((function(){e.singleTap.dispatch(t,e.element)}),250))),this.touchEnd.dispatch(t,this.element),this.preV.x=0,this.preV.y=0,this.zoom=1,this.pinchStartLen=null,this.x1=this.x2=this.y1=this.y2=null}},cancelAll:function(){this._preventTap=!0,clearTimeout(this.singleTapTimeout),clearTimeout(this.tapTimeout),clearTimeout(this.longTapTimeout),clearTimeout(this.swipeTimeout)},cancel:function(t){this.cancelAll(),this.touchCancel.dispatch(t,this.element)},_cancelLongTap:function(){clearTimeout(this.longTapTimeout)},_cancelSingleTap:function(){clearTimeout(this.singleTapTimeout)},_swipeDirection:function(t,e,i,n){return Math.abs(t-e)>=Math.abs(i-n)?t-e>0?"Left":"Right":i-n>0?"Up":"Down"},on:function(t,e){this[t]&&this[t].add(e)},off:function(t,e){this[t]&&this[t].del(e)},destroy:function(){return this.singleTapTimeout&&clearTimeout(this.singleTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.swipeTimeout&&clearTimeout(this.swipeTimeout),this.element.removeEventListener("touchstart",this.start),this.element.removeEventListener("touchmove",this.move),this.element.removeEventListener("touchend",this.end),this.element.removeEventListener("touchcancel",this.cancel),this.rotate.del(),this.touchStart.del(),this.multipointStart.del(),this.multipointEnd.del(),this.pinch.del(),this.swipe.del(),this.tap.del(),this.doubleTap.del(),this.longTap.del(),this.singleTap.del(),this.pressMove.del(),this.twoFingerPressMove.del(),this.touchMove.del(),this.touchEnd.del(),this.touchCancel.del(),this.preV=this.pinchStartLen=this.zoom=this.isDoubleTap=this.delta=this.last=this.now=this.tapTimeout=this.singleTapTimeout=this.longTapTimeout=this.swipeTimeout=this.x1=this.x2=this.y1=this.y2=this.preTapPosition=this.rotate=this.touchStart=this.multipointStart=this.multipointEnd=this.pinch=this.swipe=this.tap=this.doubleTap=this.longTap=this.singleTap=this.pressMove=this.touchMove=this.touchEnd=this.touchCancel=this.twoFingerPressMove=null,window.removeEventListener("scroll",this._cancelAllHandler),null}},t.exports=s}()},"g+tZ":function(t,e,i){"use strict";i.r(e),i.d(e,"WorkPageModule",(function(){return ft}));var n=i("TEn/"),s=i("ofXK"),o=i("3Pt+"),a=i("tyNb"),r=i("mrSG"),c=i("BZV/"),h=i("6mc2"),l=i("fXoL"),d=i("jhN1"),g=i("PQoX");const u=["fileinput"];function p(t,e){if(1&t&&(l.Nb(0,"div",15),l.Nb(1,"div",16),l.Lb(2,"ion-icon",17),l.Nb(3,"div",18),l.pc(4),l.Mb(),l.Mb(),l.Mb()),2&t){const t=l.Xb();l.zb(2),l.cc("sortablejs",t.deletedimages)("sortablejsOptions",t.options),l.zb(2),l.qc(t.deletedimages.length)}}function m(t,e){1&t&&l.Lb(0,"ion-spinner")}function b(t,e){if(1&t&&(l.Nb(0,"div",19),l.nc(1,m,1,0,"ion-spinner",20),l.Mb()),2&t){const t=l.Xb();l.zb(1),l.cc("ngIf",t.processing)}}function f(t,e){if(1&t&&(l.Nb(0,"div"),l.Lb(1,"div",21),l.Mb()),2&t){const t=e.$implicit,i=l.Xb();l.zb(1),l.mc("background-image",i.imageMap.get(t).style,l.Db)}}let v=(()=>{class t{constructor(t,e,i){this.tools=t,this.sanitizer=e,this.modalCtrl=i,this.images=[],this.imagebackup=[],this.deletedimages=[],this.processing=!0,this.changed=!1,this.options={group:"pictures",onUpdate:t=>{if(this.images.length===this.imagebackup.length){for(let t=0;t<this.images.length;++t)if(this.images[t]!==this.imagebackup[t])return void(this.changed=!0);this.changed=!1}else this.changed=!0}},this.imageMap=new Map}ngOnInit(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(!this.files)throw new Error("Dragster files property requires FileList");this.importPhotos(this.files)}))}importPhotos(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){this.processing=!0,console.log("resizing",t.length,"files");const e=Array.from(this.files),i=[];for(const t of e){console.log("resizing",t.name);const e=yield this.tools.resizeImage(t);console.log("resizing done");const n=URL.createObjectURL(e.blob),s=this.sanitizer.bypassSecurityTrustStyle("url("+n+")"),o=this.tools.makeObjectId(),a=new Date(0);a.setUTCMilliseconds(t.lastModified),this.imageMap.set(o,{blob:e.blob,width:e.width,height:e.height,style:s,date:a,name:t.name}),i.push(o)}this.images=[...this.images,...i],this.imagebackup=this.images.slice(0),this.processing=!1}))}reset(){this.images=this.imagebackup.slice(0),this.deletedimages=[]}handleFiles(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){t.preventDefault(),0!==t.target.files.length?this.importPhotos(t.target.files):console.log("No files selected")}))}accept(){const t=this.images.map(t=>{const e=this.imageMap.get(t);return{date:e.date,name:e.name,width:e.width,height:e.height,blob:this.imageMap.get(t).blob}});this.modalCtrl.dismiss({photos:t,coverIndex:0})}close(){this.modalCtrl.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(l.Kb(h.a),l.Kb(d.b),l.Kb(n.x))},t.\u0275cmp=l.Eb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){var i;1&t&&l.lc(u,!0),2&t&&l.fc(i=l.Wb())&&(e.inputElement=i.first)},inputs:{files:"files"},decls:15,vars:6,consts:[["slot","icon-only","name","close",1,"closebutton",3,"click"],[1,"mainlayout"],["class","statusbar",4,"ngIf"],["class","loading",4,"ngIf"],[1,"scroller"],[1,"pics",3,"sortablejs","sortablejsOptions"],[4,"ngFor","ngForOf"],["vertical","bottom","horizontal","center","slot","fixed",1,"foo"],[3,"disabled","click"],["name","refresh"],["vertical","bottom","horizontal","end","slot","fixed",1,"foo"],[3,"click"],["name","checkmark-outline"],["multiple","","type","file","name","name","accept","image/*",2,"display","none",3,"change"],["fileinput",""],[1,"statusbar"],[1,"trashbox"],["name","trash-bin",3,"sortablejs","sortablejsOptions"],[1,"count"],[1,"loading"],[4,"ngIf"],[1,"image",2,"background-size","cover","background-position","center","background-repeat","no-repeat"]],template:function(t,e){1&t&&(l.Nb(0,"ion-icon",0),l.Vb("click",(function(){return e.close()})),l.Mb(),l.Nb(1,"div",1),l.nc(2,p,5,3,"div",2),l.nc(3,b,2,1,"div",3),l.Nb(4,"div",4),l.Nb(5,"div",5),l.nc(6,f,2,2,"div",6),l.Mb(),l.Mb(),l.Nb(7,"ion-fab",7),l.Nb(8,"ion-fab-button",8),l.Vb("click",(function(){return e.reset()})),l.Lb(9,"ion-icon",9),l.Mb(),l.Mb(),l.Nb(10,"ion-fab",10),l.Nb(11,"ion-fab-button",11),l.Vb("click",(function(){return e.accept()})),l.Lb(12,"ion-icon",12),l.Mb(),l.Mb(),l.Nb(13,"input",13,14),l.Vb("change",(function(t){return e.handleFiles(t)})),l.Mb(),l.Mb()),2&t&&(l.zb(2),l.cc("ngIf",!e.processing),l.zb(1),l.cc("ngIf",e.processing),l.zb(2),l.cc("sortablejs",e.images)("sortablejsOptions",e.options),l.zb(1),l.cc("ngForOf",e.images),l.zb(2),l.cc("disabled",!e.changed))},directives:[n.k,s.k,g.a,s.j,n.h,n.i,n.p],styles:['.mainlayout[_ngcontent-%COMP%]{width:100%;height:100%}.mainlayout[_ngcontent-%COMP%]   .statusbar[_ngcontent-%COMP%]{width:100%;max-width:100%;height:60px;display:flex;flex-direction:row;justify-content:space-between;align-items:flex-end;padding:5px}.mainlayout[_ngcontent-%COMP%]   .statusbar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:40px;width:40px;height:40px;color:var(--ion-color-primary)}.mainlayout[_ngcontent-%COMP%]   .statusbar[_ngcontent-%COMP%]   ion-icon.disabled[_ngcontent-%COMP%]{opacity:.5}.mainlayout[_ngcontent-%COMP%]   .statusbar[_ngcontent-%COMP%]   .trashbox[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:flex-end;font-weight:700}.mainlayout[_ngcontent-%COMP%]   .statusbar[_ngcontent-%COMP%]   .trashbox[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.mainlayout[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]{width:100%;height:60px;display:flex;flex-direction:row;justify-content:center;padding:5px}.mainlayout[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:40px;height:40px;--color:var(--ion-color-primary)}.mainlayout[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]{width:100%;height:calc(100% - 130px);margin-bottom:100px;overflow-y:scroll;overflow-x:hidden}.mainlayout[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .pics[_ngcontent-%COMP%]{display:grid;grid-template-columns:32vw 32vw 32vw;grid-template-rows:auto;grid-gap:2vw;-webkit-filter:drop-shadow(-1px 1px 3px grey);filter:drop-shadow(-1px 1px 3px grey)}.mainlayout[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .pics[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%;height:22.5vw;background-size:cover;background-position:50%;background-repeat:no-repeat}.mainlayout[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .pics[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]:before{content:"";display:block;height:0;width:0;padding-bottom:133.33333%}.sortable-drag[_ngcontent-%COMP%]{display:none}ion-fab-button[_ngcontent-%COMP%]{--color:var(--ion-background-color)}']}),t})();function w(t,e){if(1&t){const t=l.Ob();l.Nb(0,"ion-button",3),l.Vb("click",(function(){l.hc(t);const i=e.$implicit;return l.Xb().accept(i)})),l.pc(1),l.Mb()}if(2&t){const t=e.$implicit;l.zb(1),l.qc(t)}}let y=(()=>{class t{constructor(t){this.popCtrl=t}accept(t){this.popCtrl.dismiss(t)}}return t.\u0275fac=function(e){return new(e||t)(l.Kb(n.z))},t.\u0275cmp=l.Eb({type:t,selectors:[["app-confirm"]],inputs:{options:"options",text:"text"},decls:4,vars:2,consts:[[1,"popcontainer"],[1,"text"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(t,e){1&t&&(l.Nb(0,"div",0),l.Nb(1,"div",1),l.pc(2),l.Mb(),l.nc(3,w,2,1,"ion-button",2),l.Mb()),2&t&&(l.zb(2),l.rc(" ",e.text," "),l.zb(1),l.cc("ngForOf",e.options))},directives:[s.j,n.c],styles:["div.popcontainer[_ngcontent-%COMP%]{padding:10px;display:flex;flex-direction:column}div.popcontainer[_ngcontent-%COMP%]   div.text[_ngcontent-%COMP%]{padding:5px;text-align:center;font-size:20px}"],changeDetection:0}),t})();var C={prefix:"fas",iconName:"check",icon:[512,512,[],"f00c","M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"]},x={prefix:"fas",iconName:"microphone",icon:[352,512,[],"f130","M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"]},P={prefix:"fas",iconName:"pause",icon:[448,512,[],"f04c","M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"]},M={prefix:"fas",iconName:"play",icon:[448,512,[],"f04b","M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"]},O={prefix:"fas",iconName:"square",icon:[448,512,[],"f0c8","M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"]},D=i("pooC");const E=["frames"],T=["images"],I=["overlays"];function R(t,e){1&t&&l.Lb(0,"ion-spinner")}function A(t,e){if(1&t&&(l.Nb(0,"div",15,16),l.Lb(2,"img",17,18),l.Lb(4,"canvas",19,20),l.Mb()),2&t){const t=e.$implicit,i=e.index,n=l.Xb();l.zb(2),l.cc("src",t.src,l.jc),l.zb(2),l.cc("width",t.width)("height",t.height)("ngStyle",n.cstyle[i])}}function S(t,e){1&t&&l.Lb(0,"ion-icon",21)}const _=function(t,e){return{selected:t,marked:e}};function k(t,e){if(1&t&&(l.Nb(0,"div"),l.Lb(1,"div",22),l.Mb()),2&t){const t=e.$implicit,i=l.Xb();l.zb(1),l.cc("ngClass",l.dc(1,_,t===i.current,t<=i.highwater))}}function L(t,e){1&t&&l.Lb(0,"ion-icon",23)}let z=(()=>{class t{constructor(t,e,i,n){this.sesh=t,this.detol=e,this.tools=i,this.change=n,this.selected=0,this.enabled=!1,this.reverse=!1,this.highwater=0,this.move=new l.n,this.current=0,this.loading=!0,this.imageList=[],this.thumbs={prev:"",cur:"",next:""},this.progress=[],this.started=new D.Deferred,this.cstyle=[]}ngOnInit(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){for(const t of this.images)this.imageList.push(yield this.sesh.getLocalImageFromId(t)),console.log(t);this.setThumbs(),this.progress=Array.from({length:this.imageList.length},(t,e)=>e),this.orientListener=()=>{this.homeIndex(this.current)},window.addEventListener("resize",this.orientListener),this.change.markForCheck(),setTimeout(()=>{this.loading=!1,this.resizeCanvas(),this.change.markForCheck(),this.started.resolve()},100)}))}waitForStart(){return this.started.promise}ngOnDestroy(){window.removeEventListener("resize",this.orientListener)}seekTo(t,e="auto"){this.current=t,this._moveTo(this.current,e)}getCurrent(){return this.current}setThumbs(){this.thumbs={prev:this.current>0?this.imageList[this.current-1].style:"",cur:this.imageList[this.current].style,next:this.current<this.imageList.length-1?this.imageList[this.current+1].style:""}}clickThumb(t){if(!this.enabled)return;if(!this.reverse&&-1===t)return;const e=this.current+t;e<0||e>=this.imageList.length||(this.current=e,this.move.emit(e),this._moveTo(e,"smooth"))}_moveTo(t,e="auto"){this.homeIndex(t,e),this.setThumbs()}homeIndex(t,e="auto"){return Object(r.__awaiter)(this,void 0,void 0,(function*(){console.log("scrolling"),yield this.tools.smoothScroll(this.frameElements.toArray()[t].nativeElement),console.log("done"),this.resizeCanvas()}))}resizeCanvas(){this.cstyle=this.imageElements.map(t=>({width:t.nativeElement.width.toString()+"px",height:t.nativeElement.height.toString()+"px"})),console.log("cstyle",this.cstyle)}getCanvas(t){try{return{canvas:this.canvasElements.toArray()[t].nativeElement,width:this.imageList[t].width,height:this.imageList[t].height}}catch(e){console.log("canvas elements",this.canvasElements.toArray())}}}return t.\u0275fac=function(e){return new(e||t)(l.Kb(c.a),l.Kb(d.b),l.Kb(h.a),l.Kb(l.h))},t.\u0275cmp=l.Eb({type:t,selectors:[["app-swiper"]],viewQuery:function(t,e){var i;1&t&&(l.sc(E,!0),l.sc(T,!0),l.sc(I,!0)),2&t&&(l.fc(i=l.Wb())&&(e.frameElements=i),l.fc(i=l.Wb())&&(e.imageElements=i),l.fc(i=l.Wb())&&(e.canvasElements=i))},inputs:{images:"images",selected:"selected",enabled:"enabled",reverse:"reverse",highwater:"highwater"},outputs:{move:"move"},decls:16,vars:9,consts:[[4,"ngIf"],[1,"layout"],[1,"mainwrapper"],[1,"mainscroller"],["scroller",""],["class","frame",4,"ngFor","ngForOf"],[1,"thumbwrapper"],[1,"thumbslot","imageslot","left",3,"click"],[1,"image"],["name","arrow-back","class","arrow back",4,"ngIf"],[1,"thumbslot","progressslot"],[1,"progress"],[4,"ngFor","ngForOf"],[1,"thumbslot","imageslot","right",3,"click"],["name","arrow-forward","class","arrow forward",4,"ngIf"],[1,"frame"],["frames",""],[3,"src"],["images",""],[3,"width","height","ngStyle"],["overlays",""],["name","arrow-back",1,"arrow","back"],[1,"bullet",3,"ngClass"],["name","arrow-forward",1,"arrow","forward"]],template:function(t,e){1&t&&(l.nc(0,R,1,0,"ion-spinner",0),l.Nb(1,"div",1),l.Nb(2,"div",2),l.Nb(3,"div",3,4),l.nc(5,A,6,4,"div",5),l.Mb(),l.Nb(6,"div",6),l.Nb(7,"div",7),l.Vb("click",(function(){return e.clickThumb(-1)})),l.Lb(8,"div",8),l.nc(9,S,1,0,"ion-icon",9),l.Mb(),l.Nb(10,"div",10),l.Nb(11,"div",11),l.nc(12,k,2,4,"div",12),l.Mb(),l.Mb(),l.Nb(13,"div",13),l.Vb("click",(function(){return e.clickThumb(1)})),l.Lb(14,"div",8),l.nc(15,L,1,0,"ion-icon",14),l.Mb(),l.Mb(),l.Mb(),l.Mb()),2&t&&(l.cc("ngIf",e.loading),l.zb(5),l.cc("ngForOf",e.imageList),l.zb(3),l.mc("background-image",e.thumbs.prev,l.Db),l.zb(1),l.cc("ngIf",e.reverse&&0!==e.current),l.zb(3),l.cc("ngForOf",e.progress),l.zb(2),l.mc("background-image",e.thumbs.next,l.Db),l.zb(1),l.cc("ngIf",e.current!==e.imageList.length-1))},directives:[s.k,s.j,n.p,s.l,n.k,s.i],styles:["ion-spinner[_ngcontent-%COMP%]{width:100px;height:100px;margin-left:auto;margin-right:auto}.layout[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;position:relative}.layout[_ngcontent-%COMP%]   .mainwrapper[_ngcontent-%COMP%]{width:60vw;height:45vw}.layout[_ngcontent-%COMP%]   .mainwrapper[_ngcontent-%COMP%]   .mainscroller[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:hidden;white-space:nowrap;width:60vw;height:45vw;position:relative;pointer-events:none}.layout[_ngcontent-%COMP%]   .mainwrapper[_ngcontent-%COMP%]   .mainscroller[_ngcontent-%COMP%]   .frame[_ngcontent-%COMP%]{width:60vw;height:45vw;max-height:45vw;display:inline-block;position:relative;margin-right:5px}.layout[_ngcontent-%COMP%]   .mainwrapper[_ngcontent-%COMP%]   .mainscroller[_ngcontent-%COMP%]   .frame[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;left:0;top:0;bottom:0;right:0;-o-object-fit:contain;object-fit:contain;max-height:100%;max-width:100%;margin:auto;display:block;-webkit-filter:drop-shadow(1px 1px 2px var(--ion-color-dark));filter:drop-shadow(1px 1px 2px var(--ion-color-dark))}.layout[_ngcontent-%COMP%]   .mainwrapper[_ngcontent-%COMP%]   .mainscroller[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{position:absolute;pointer-events:auto;top:0;left:0;bottom:0;right:0;z-index:5;margin:auto;display:block;touch-action:none}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]{position:absolute;width:100%;top:25%;left:0;display:flex;flex-direction:row;justify-content:space-between;padding-left:5px;padding-right:5px;overflow:hidden}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .thumbslot[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .thumbslot.imageslot[_ngcontent-%COMP%]{display:flex}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .thumbslot.imageslot.left[_ngcontent-%COMP%]{align-items:flex-start}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .thumbslot.imageslot.right[_ngcontent-%COMP%]{align-items:flex-end}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .thumbslot.progressslot[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:17vw;height:17vw;background-size:cover;-webkit-filter:drop-shadow(1px 1px 2px var(--ion-color-dark));filter:drop-shadow(1px 1px 2px var(--ion-color-dark))}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{width:60vw;height:30px;display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;color:var(--ion-color-primary);height:12px}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .bullet[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;border:1px solid var(--ion-color-primary-deselect);margin:2px 1.5px}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .bullet.selected[_ngcontent-%COMP%]{background:var(--ion-color-primary-deselect)}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .bullet.marked[_ngcontent-%COMP%]{border:1px solid var(--ion-color-primary)}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .bullet.selected.marked[_ngcontent-%COMP%]{background:var(--ion-color-primary)}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   ion-icon.arrow[_ngcontent-%COMP%]{font-size:35px;color:var(--ion-color-primary);bottom:18vh}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   ion-icon.arrow.back[_ngcontent-%COMP%]{left:5px}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   ion-icon.arrow.forward[_ngcontent-%COMP%]{right:5px}.image[_ngcontent-%COMP%]{background-position:50%;background-repeat:no-repeat}@media (orientation:portrait){.layout[_ngcontent-%COMP%]   .mainwrapper[_ngcontent-%COMP%], .layout[_ngcontent-%COMP%]   .mainwrapper[_ngcontent-%COMP%]   .mainscroller[_ngcontent-%COMP%]{width:100vw;height:75vw}.layout[_ngcontent-%COMP%]   .mainwrapper[_ngcontent-%COMP%]   .mainscroller[_ngcontent-%COMP%]   .frame[_ngcontent-%COMP%]{width:100vw;height:75vw;max-height:75vw}.layout[_ngcontent-%COMP%]   .mainwrapper[_ngcontent-%COMP%]   .mainscroller[_ngcontent-%COMP%]   .frame[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%;height:100%}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]{position:absolute;width:100%;top:calc(75vw + 10px)}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .thumbslot.imageslot[_ngcontent-%COMP%]{display:flex}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .thumbslot.imageslot[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:30vw;height:30vw}.layout[_ngcontent-%COMP%]   .thumbwrapper[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{width:30vw}}"]}),t})();var N=i("XNiG"),j=function(t){return t[t.STOPPED=0]="STOPPED",t[t.STARTING=1]="STARTING",t[t.RECORDING=2]="RECORDING",t[t.STOPPING=3]="STOPPING",t}({});class F{constructor(t){this.connected=!1,this.progressSubject=new N.a,this.config={bufferLen:4096,numChannels:1},this.recordingState=j.STOPPED,this.stopTick=0,this.startRecording=null,this.recordedData=[],this.pinterval=null,this.volume=-50,this.audioContext=t&&t.audioContext?t.audioContext:new AudioContext,this.debugMode=!(!t||!t.debug)&&t.debug,t&&t.bufferLen&&(this.config.bufferLen=t.bufferLen),this._init()}_init(){this.debug("init()")}debug(...t){this.debugMode&&console.log("simpleMicrophone:",...t)}connect(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("No mediaDevices.getUserMedia in browser!");let t=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});this.sourceNode=this.audioContext.createMediaStreamSource(t),this.stream=t,this.node=this.audioContext.createScriptProcessor(this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=t=>{const e=t.inputBuffer.getChannelData(0);if(this._setVolumeFromBuffer(e),this.recordingState!==j.STOPPED){if(this.recordingState===j.STARTING){for(let t=0;t<2e3;++t)e[t]=t/2e3*e[t];this.debug("recording - set recording state"),this.recordingState=j.RECORDING}else if(this.recordingState===j.STOPPING)if(1===this.stopTick){this.debug("set recording stopped state"),this.recordingState=j.STOPPED;for(let t=0;t<2e3;++t)e[-t]=t/2e3*e[-t]}else++this.stopTick;this.recordedData.push(e.slice(0))}},this.sourceNode.connect(this.node),this.node.connect(this.audioContext.destination),this.connected=!0,this._progressTick()}))}_setVolumeFromBuffer(t){let e,i=0;for(let o=0;o<t.length;o++)e=t[o],i+=e*e;let n=Math.sqrt(i/t.length),s=Math.max(n,.95*this.volume);this.volume=10*Math.log(s)}record(){if(!this.sourceNode)throw new Error("No source node, did you call .connect() first?");if(!this.canRecord())throw new Error("Cannot start recording, check canRecord() first.");this.debug("recording - set start state"),this.startRecording=new Date,this.recordingState=j.STARTING}destroy(){if(this.stream)for(let t of this.stream.getAudioTracks())t.stop();this.connected=!1,this.progressSubject.complete()}getElapsed(){return this.getLength().ms}isRecording(){return this.recordingState!==j.STOPPED}hasRecordedData(){return 0!==this.recordedData.length}observeProgress(){return this.progressSubject.asObservable()}pause(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(this.isRecording())for(this.debug("recording set stopping state"),this.recordingState=2,this.debug("pausing");this.isRecording();)yield this._waitMilliseconds(100)}))}canRecord(){return this.connected&&this.recordingState==j.STOPPED}resume(){return!this.isRecording()&&(this.recordingState=j.STARTING,!0)}stop(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){for(this.debug("recording set stopping state"),this.recordingState=j.STOPPING;this.isRecording();)yield this._waitMilliseconds(100);return this.getLength()}))}getLength(){let t=0;for(let e of this.recordedData)t+=e.length;return{ms:Math.floor(t/this.audioContext.sampleRate*1e3),frames:t}}_waitMilliseconds(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}getBuffer(){return this._getMergedBuffers(this.recordedData)}clear(){this.recordingState=j.STOPPED,this.recordedData=[],console.log("simple microphone cleared",this.recordedData)}_progressTick(){this.pinterval||(this.pinterval=setInterval(()=>{this.progressSubject.next({elapsed:this.getElapsed(),db:this.volume})},100))}_getMergedBuffers(t){let e=0;for(let s of t)e+=s.length;let i=new Float32Array(e),n=0;for(let s=0;s<t.length;s++)i.set(t[s],n),n+=t[s].length;return i}}class B{constructor(t){this.config={audioContext:new AudioContext,sampleRate:16e3,channels:1},this.buffer=null,this.playing=!1,this.replaying=!1,this.progressSubject=new N.a,t&&Object.assign(this.config,t)}loadFile(t){return this.config.sampleRate=t.sampleRate,new Promise(e=>{const i=new FileReader;i.onloadend=()=>{new OfflineAudioContext(1,1,this.config.sampleRate).decodeAudioData(i.result).then(i=>{const n=new Float32Array(t.frames);i.copyFromChannel(n,0),this.buffer=n,e()})},i.readAsArrayBuffer(t.file)})}addResample(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){const e=yield this._resampleBuffer(t),i=this.buffer?this.buffer.length:0;return this.buffer=this.buffer?this._mergeBuffers([this.buffer,e]):e,{offset:i,frames:e.length}}))}getLength(){return{frames:null!==this.buffer?this.buffer.length:0,ms:null!==this.buffer?~~(this.buffer.length/this.config.sampleRate*1e3):0}}_resampleBuffer(t){const e=new OfflineAudioContext(1,~~(t.length/this.config.audioContext.sampleRate*this.config.sampleRate),this.config.sampleRate),i=e.createBuffer(1,t.length,this.config.audioContext.sampleRate);i.copyToChannel(t,0);const n=e.createBufferSource();return n.buffer=i,n.connect(e.destination),n.start(),e.startRendering().then(t=>new Float32Array(t.getChannelData(0)))}deleteFrom(t){this.buffer=0===t?null:this.buffer.slice(0,t)}exportWav(){const t=(t,e,i)=>{for(let n=0;n<i.length;n++)t.setUint8(e+n,i.charCodeAt(n))};return new Blob([((e,i)=>{const n=this.buffer.length,s=new ArrayBuffer(44+2*n),o=new DataView(s);return t(o,0,"RIFF"),o.setUint32(4,36+2*n,!0),t(o,8,"WAVE"),t(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,1,!0),o.setUint32(24,i,!0),o.setUint32(28,4*i,!0),o.setUint16(32,2,!0),o.setUint16(34,16,!0),t(o,36,"data"),o.setUint32(40,2*n,!0),((t,e,i)=>{for(let n=0;n<i.length;n++,e+=2){let s=Math.max(-1,Math.min(1,i[n]));t.setInt16(e,s<0?32768*s:32767*s,!0)}})(o,44,this.buffer),o})(0,this.config.sampleRate)],{type:"audio/wav"})}clear(){this.buffer=null}_mergeBuffers(t){let e=0;for(let s of t)e+=s.length;const i=new Float32Array(e);let n=0;for(let s=0;s<t.length;s++)i.set(t[s],n),n+=t[s].length;return i}playFromMs(t=0){this.playstartfromms=t;const e=Math.round(t/1e3*16e3);this.playFromFrame(e)}playFromFrame(t=0){if(null===this.buffer)throw new Error("No audio data in buffer");if(t>=this.buffer.length)throw new Error("listen From frame is larger than buffer");this.playing?(this.playsource.stop(),this.replaying=!0):this.replaying=!1;const e=this.config.audioContext.createBuffer(1,this.buffer.length-t,this.config.sampleRate),i=this.buffer.slice(t);e.getChannelData(0).set(i);const n=this.config.audioContext.createBufferSource();n.buffer=e,n.connect(this.config.audioContext.destination),n.start(),this.playing=!0,this.playsource=n,this.playstarttime=new Date,n.onended=()=>{this.replaying?this.replaying=!1:(this.progressSubject.next(-1),this.playing=!1)},this.progressLoop()}stopPlay(){this.playing&&(this.replaying=!1,this.playsource.stop(),this.playing=!1)}progressLoop(){if(this.playing){const t=(new Date).valueOf()-this.playstarttime.valueOf();this.progressSubject.next(this.playstartfromms+t),this.playing&&setTimeout(()=>{this.progressLoop()},100)}}getPlayProgress(){return this.progressSubject.asObservable()}hasData(){return null!==this.buffer}destroy(){this.stopPlay(),this.progressSubject.complete()}}var Y=i("EnSQ");let V=(()=>{class t{constructor(t){this.tools=t,this.audioCtx=new AudioContext,this.players=new Map}resumeAudioContext(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){"running"!==this.audioCtx.state&&(yield this.audioCtx.resume())}))}getAudioContext(){return this.audioCtx}errorbeep(){new Audio("data:audio/wav;base64,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").play()}confbeep(){new Audio("data:audio/wav;base64,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").play()}getWavMetadata(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){return new Promise(e=>{let i=new FileReader;i.onloadend=()=>{const t=new DataView(i.result),n=t.getUint16(22,!0),s=t.getUint32(24,!0),o=t.getUint32(40,!0),a=t.getUint16(32,!0);e({channelCount:n,sampleRate:s,samples:o/a,duration:o/a/s})},i.readAsArrayBuffer(t)})}))}getAudioMetadata(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){return new Promise(e=>{let i=new FileReader;i.onloadend=()=>{this.audioCtx.decodeAudioData(i.result).then(t=>{e({channels:t.numberOfChannels,sampleRate:t.sampleRate,samples:t.length,duration:t.length/t.sampleRate})})},i.readAsArrayBuffer(t)})}))}resampleBuffer(t,e,i){const n=new OfflineAudioContext(1,~~(t.length/e.sampleRate*i),i),s=n.createBuffer(1,t.length,e.sampleRate);s.copyToChannel(t,0);const o=n.createBufferSource();return o.buffer=s,o.connect(n.destination),o.start(),n.startRendering().then(t=>new Float32Array(t.getChannelData(0)))}float32ArrayToWav(t,e,i){const n=(t,e,i)=>{for(let n=0;n<i.length;n++)t.setUint8(e+n,i.charCodeAt(n))};return new Blob([(()=>{const s=t.length;var o=new ArrayBuffer(44+2*s),a=new DataView(o);return n(a,0,"RIFF"),a.setUint32(4,36+2*s,!0),n(a,8,"WAVE"),n(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,e,!0),a.setUint32(24,i,!0),a.setUint32(28,4*i,!0),a.setUint16(32,2*e,!0),a.setUint16(34,16,!0),n(a,36,"data"),a.setUint32(40,2*s,!0),((t,e,i)=>{for(let n=0;n<i.length;n++,e+=2){let s=Math.max(-1,Math.min(1,i[n]));t.setInt16(e,s<0?32768*s:32767*s,!0)}})(a,44,t),a})()],{type:"audio/wav"})}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(h.a))},t.\u0275prov=l.Gb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var G=i("6NWb");function Q(t,e){if(1&t){const t=l.Ob();l.Nb(0,"ion-fab",8),l.Vb("click",(function(){return l.hc(t),l.Xb().finish()})),l.Nb(1,"ion-fab-button"),l.Lb(2,"ion-icon",9),l.Mb(),l.Mb()}}const H=function(t,e,i){return{playing:t,disabled:e,"ion-activatable":i}},W=function(t,e,i){return{recording:t,disabled:e,"ion-activatable":i}};var U=function(t){return t[t.LOADING=1]="LOADING",t[t.READY=2]="READY",t[t.RECORDING=3]="RECORDING",t[t.RECBUSY=4]="RECBUSY",t[t.REVIEWING=5]="REVIEWING",t}({});let Z=(()=>{class t{constructor(t,e,i,n,s,o){this.modalCtrl=t,this.data=e,this.audio=i,this.popCtrl=n,this.tools=s,this.seshservice=o,this.faSquare=O,this.faPause=P,this.faPlay=M,this.elapsed=0,this.currentIndex=0,this.recordedMark=-1,this.startupPromises=[],this.state=U.LOADING,this.timeLine=[],this.startLength=0}ngOnInit(){console.log(this.session),this.changeState(U.LOADING),this.session.igvTimeline&&(this.recordedMark=this.session.igvTimeline.length-1,this.timeLine=this.session.igvTimeline),this.startupPromises.push(this.initialise())}ngAfterViewInit(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){this.startupPromises.push(this.swiper.waitForStart()),yield Promise.all(this.startupPromises),console.log("everything ready"),this.changeState(U.READY)}))}ngOnDestroy(){this.playSub&&this.playSub.unsubscribe()}initialise(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(this.audioContext=this.audio.getAudioContext(),this.audioDataModel=new B({audioContext:this.audioContext,sampleRate:16e3,channels:1}),this.playSub=this.audioDataModel.getPlayProgress().subscribe(t=>{this.state===U.REVIEWING&&-1===t?this.changeState(U.READY):this.checkSlidePlayback(t)}),this.session.primary){const t=yield this.data.getAudioFile(this.session.primary);yield this.audioDataModel.loadFile(t)}this.startLength=this.audioDataModel.getLength().frames,this.microphone=new F({audioContext:this.audioContext}),yield this.microphone.connect()}))}close(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(this.hasChanged()){const e=yield this.confirm("Quit and discard changes?",["Yep","Nah"],t);if(!e||"Nah"===e)return}this.modalCtrl.dismiss()}))}clickRecord(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(this.flags.canPressRecord)if(this.state===U.RECORDING){console.log("stopping"),this.changeState(U.RECBUSY);const t=yield this.microphone.stop();console.log("stopped"),yield this.audioDataModel.addResample(this.microphone.getBuffer()),this.microphone.clear(),this.getLastSegment().endMs=this.audioDataModel.getLength().ms+t.ms,this.changeState(U.READY)}else console.log("recording"),this.changeState(U.RECORDING),this.microphone.record(),this.startResumeSegment()}))}clickPlay(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){this.flags.canReview&&(this.state===U.REVIEWING?this.audioDataModel.stopPlay():(this.changeState(U.REVIEWING),this.currentIndex=0,this.swiper.seekTo(this.currentIndex),this.audioDataModel.playFromMs(0),console.log(this.timeLine)))}))}swiperMove(t){console.log("slide",t),this.currentIndex=t,this.state===U.RECORDING?(this.transitionSlide(),t>this.recordedMark&&(this.recordedMark=t)):this.state===U.REVIEWING&&(this.currentIndex<this.timeLine.length-1?this.audioDataModel.playFromMs(this.timeLine[this.currentIndex].startMs):this.changeState(U.READY))}changeState(t){t===U.LOADING?this.flags={isRecording:!1,isReviewing:!1,canSlide:!1,canReverse:!1,canPressRecord:!1,canReview:!1,canFinish:!1}:t===U.READY?this.flags={isRecording:!1,isReviewing:!1,canSlide:!0,canReverse:!0,canPressRecord:!0,canReview:this.audioDataModel.hasData(),canFinish:this.hasChanged()}:t===U.RECORDING?(this.flags={isRecording:!0,isReviewing:!1,canSlide:!0,canReverse:!1,canPressRecord:!0,canReview:!1,canFinish:!1},this.currentIndex!==this.recordedMark&&(-1===this.recordedMark?(this.currentIndex=0,this.recordedMark=0):this.currentIndex=this.recordedMark,this.swiper.seekTo(this.currentIndex))):t===U.RECBUSY?this.flags={isRecording:!0,isReviewing:!1,canSlide:!1,canReverse:!1,canPressRecord:!1,canReview:!1,canFinish:!1}:t===U.REVIEWING&&(this.flags={isRecording:!1,isReviewing:!0,canSlide:!0,canReverse:!0,canPressRecord:!1,canReview:!0,canFinish:this.hasChanged()}),this.state=t}hasChanged(){return this.startLength!==this.audioDataModel.getLength().frames}getLastSegment(){return this.timeLine[this.timeLine.length-1]}startResumeSegment(){0===this.timeLine.length&&this.timeLine.push({startMs:0,promptId:this.session.imageIds[0]})}transitionSlide(){const t=this.audioDataModel.getLength().ms+this.microphone.getElapsed();this.getLastSegment().endMs=t-1,this.timeLine.push({startMs:t,promptId:this.session.imageIds[this.currentIndex]})}checkSlidePlayback(t){const e=this.timeLine.findIndex(e=>t>=e.startMs&&t<=e.endMs);-1!==e&&e!==this.currentIndex&&(this.currentIndex=e,this.swiper.seekTo(this.currentIndex,"smooth"))}finish(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){this.timeLine.length===this.session.imageIds.length&&++this.session.stage;const t={blob:this.audioDataModel.exportWav(),language:"",frames:this.audioDataModel.getLength().frames,channels:this.audioDataModel.config.channels,sampleRate:this.audioDataModel.config.sampleRate};this.seshservice.updateSessionPrimaryAudio(this.session.id,{stage:this.session.stage,igvTimeline:this.timeLine},t),this.modalCtrl.dismiss()}))}confirm(t,e,i=null){return Object(r.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.popCtrl.create({component:y,componentProps:{text:t,options:e}});return yield this.tools.showPopover(i)}))}}return t.\u0275fac=function(e){return new(e||t)(l.Kb(n.x),l.Kb(Y.a),l.Kb(V),l.Kb(n.z),l.Kb(h.a),l.Kb(c.a))},t.\u0275cmp=l.Eb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){var i;1&t&&l.sc(z,!0),2&t&&l.fc(i=l.Wb())&&(e.swiper=i.first)},inputs:{session:"session"},decls:10,vars:19,consts:[["slot","icon-only","name","close",1,"closebutton",3,"click"],[3,"images","enabled","reverse","selected","highwater","move"],[1,"bigbutton","play","ion-activatable",3,"ngClass","click"],["type","unbounded"],[3,"icon"],[1,"bigbutton","record","ion-activatable",3,"ngClass","click"],[3,"icon","spin"],["class","finishbutton","horizontal","center","vertical","bottom",3,"click",4,"ngIf"],["horizontal","center","vertical","bottom",1,"finishbutton",3,"click"],["name","checkmark"]],template:function(t,e){1&t&&(l.Nb(0,"ion-icon",0),l.Vb("click",(function(t){return e.close(t)})),l.Mb(),l.Nb(1,"app-swiper",1),l.Vb("move",(function(t){return e.swiperMove(t)})),l.Mb(),l.pc(2,"> "),l.Nb(3,"div",2),l.Vb("click",(function(){return e.clickPlay()})),l.Lb(4,"ion-ripple-effect",3),l.Lb(5,"fa-icon",4),l.Mb(),l.Nb(6,"div",5),l.Vb("click",(function(){return e.clickRecord()})),l.Lb(7,"ion-ripple-effect",3),l.Lb(8,"fa-icon",6),l.Mb(),l.nc(9,Q,3,0,"ion-fab",7)),2&t&&(l.zb(1),l.cc("images",e.session.imageIds)("enabled",e.flags.canSlide)("reverse",e.flags.canReverse)("selected",e.currentIndex)("highwater",e.recordedMark),l.zb(2),l.cc("ngClass",l.ec(11,H,e.flags.isReviewing,!e.flags.canReview,e.flags.canReview)),l.zb(2),l.cc("icon",e.flags.isReviewing?e.faPause:e.faPlay),l.zb(1),l.cc("ngClass",l.ec(15,W,e.flags.isRecording,!e.flags.canSlide,e.flags.canPressRecord)),l.zb(2),l.cc("icon",e.faSquare)("spin",e.flags.isRecording),l.zb(1),l.cc("ngIf",e.flags.canFinish))},directives:[n.k,z,s.i,n.m,G.a,s.k,n.h,n.i],styles:["div.bigbutton[_ngcontent-%COMP%]{width:100px;height:100px;position:absolute;bottom:5px;border-radius:50%;background-color:var(--ion-color-primary);display:flex;align-items:center;justify-content:center;box-shadow:0 3px 5px -1px rgba(0,0,0,.3)}div.bigbutton[_ngcontent-%COMP%]   fa-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary-contrast);font-size:24px}.bigbutton.record[_ngcontent-%COMP%]{right:5px}.bigbutton.record.recording[_ngcontent-%COMP%]{background-color:red}.bigbutton.play[_ngcontent-%COMP%]{left:5px}.bigbutton.play.playing[_ngcontent-%COMP%]{background-color:green}.bigbutton.disabled[_ngcontent-%COMP%]{background-color:var(--ion-color-primary-deselect);opacity:.5}.finishbutton[_ngcontent-%COMP%]{bottom:5px}@media (orientation:portrait){app-swiper[_ngcontent-%COMP%]{margin-top:35px}}"]}),t})();var J=i("FAoz"),K=i.n(J),X=function(t){return t[t.READY=0]="READY",t[t.TOUCHING=1]="TOUCHING",t[t.SELECTED=2]="SELECTED",t[t.DISABLED=3]="DISABLED",t}({});class q{constructor(t,e){this.canvii=[],this.active=0,this.touchEvtSub=new N.a,this.state=X.READY,this.animating=!1,this.animateToggle=0,e.forEach((e,i)=>{const n=t.getCanvas(i);this.canvii.push({canvas:n.canvas,width:n.width,height:n.height,boxes:[]})})}activate(t){this.af&&this.af.destroy(),this.box=null,this.drawupdate("foo");const e=this.canvii[t].canvas;this.active=t,this.setState(X.READY),this.af=new K.a(e,{multipointStart:t=>{this.state!==X.DISABLED&&(console.log("start",t),this.touchEvtSub.next(X.TOUCHING),this.state=X.TOUCHING)},pinch:t=>{this.state!==X.DISABLED&&this.processpinch(t.targetTouches)},multipointEnd:t=>{this.state!==X.DISABLED&&(console.log("ended",t),this.state===X.TOUCHING&&(this.touchEvtSub.next(X.SELECTED),this.state=X.SELECTED))}})}setState(t){this.state=t}enable(){this.state=X.READY}disable(){this.state=X.DISABLED}observe(){return this.touchEvtSub.asObservable()}processpinch(t){let e=t[0].clientX,i=t[0].clientY,n=t[1].clientX,s=t[1].clientY;(e>e||i>s)&&(n=[e,e=n][0],s=[i,i=s][0]);const o=this.canvii[this.active].canvas.getBoundingClientRect();e-=o.left,i-=o.top,n-=o.left,s-=o.top,this.box={x1:e,y1:i,x2:n,y2:s},this.drawupdate("red")}getSelected(){return this.box}getMidPointCS(){const t=this.canvii[this.active].canvas.getBoundingClientRect(),e=this.box.x1+t.left+(this.box.x2-this.box.x1)/2;return{top:(this.box.y1+t.top+(this.box.y2-this.box.y1)/2).toString()+"px",left:e.toString()+"px"}}drawupdate(t){const e=this.canvii[this.active].canvas,i=e.width/e.clientWidth,n=e.getContext("2d");n.clearRect(0,0,e.width,e.height);const s=(t,e)=>{const s=e.x2-e.x1,o=e.y2-e.y1;n.strokeStyle=t,n.lineWidth=Math.round(3*i),n.beginPath(),n.rect(e.x1*i,e.y1*i,s*i,o*i),n.stroke()};for(const o of this.canvii[this.active].boxes)s("grey",o);this.box&&s(t,this.box)}savebox(){if(!this.box)throw new Error("no box to save");const t=Object.assign({},this.box);return this.canvii[this.active].boxes.push(t),this.box=null,this.drawupdate("red"),console.log(this.canvii),t}popbox(){if(0===this.canvii[this.active].boxes.length)throw new Error("no box to pop");this.canvii[this.active].boxes.pop()}getboxlength(){return this.canvii[this.active].boxes.length}animate(t){this.animatecolor=t,this.animateToggle=0,this.animating=!0,this.doanimate()}stopanimate(t){this.animating=!1,this.drawupdate(t)}doanimate(){this.animating&&(this.animateToggle?(this.drawupdate(this.animatecolor),this.animateToggle=0):(this.drawupdate("black"),this.animateToggle=1),setTimeout(()=>{this.doanimate()},400))}}class ${constructor(t){this.updateRateMs=100,this.onProgressEvent=null,this.onEndEvent=null,this.playing=!1,this.ended=!1,this.currentTime=0,this.framesPlayed=0,this.progressSubject=new N.a,this.debugMode=!1,this.pinterval=null,this.audioContext=t&&t.audioContext?t.audioContext:new AudioContext,this.debugMode=!(!t||!t.debug)&&t.debug}debug(...t){this.debugMode&&console.log("aikuplaya:",...t)}load(t){return fetch(t,{mode:"cors"}).then(t=>t.arrayBuffer().then(t=>this._decodeAndInitialize(t)))}loadFromBlob(t){return new Promise(e=>{let i=new FileReader;i.onloadend=()=>{this._decodeAndInitialize(i.result).then(()=>{e()})},i.readAsArrayBuffer(t)})}_decodeAndInitialize(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){this.pause(),this.source=null;let e=yield this.audioContext.decodeAudioData(t);this.currentTime=0,this.buffer=e,this.sampleRate=e.sampleRate,this.frames=e.length,this.channels=e.numberOfChannels,this.duration=e.duration,this.scriptBufferLength=this._pow2floor(this.sampleRate*(this.updateRateMs/1e3)),this.updateInterval=this.scriptBufferLength/this.sampleRate}))}_pow2floor(t){t++;for(var e=1;t>>=1;)e<<=1;return e}play(t=0,e){return Object(r.__awaiter)(this,void 0,void 0,(function*(){return new Promise(i=>{this.currentTime=t,this.startOffset=this.currentTime,this.source=this.audioContext.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.audioContext.destination),this.ended=!1,this.source.onended=()=>{this.playing=!1,this.debug("ended"),this.ended=!0,this.progressSubject.next(-1),i()},this.source.start(0,this.currentTime,e),this.startPlay=new Date,this.playing=!0,this.startProgress()})}))}playMs(t=0){this.play(t/1e3)}startProgress(){this.pinterval||(this.pinterval=setInterval(()=>{if(!this.playing||this.ended)clearInterval(this.pinterval),this.pinterval=null;else{let t=((new Date).valueOf()-this.startPlay.valueOf())/1e3;this.currentTime=this.startOffset+t,this.progressSubject.next(this.currentTime)}},100))}pause(){this.playing&&(this.playing=!1,this.source.onended=null,this.source.stop())}isPlaying(){return this.playing}hasEnded(){return this.ended}pos(){return this.currentTime}setPos(t){this.currentTime=t}observeProgress(){return this.progressSubject.asObservable()}playBuffer(t,e){var i=this.audioContext.createBufferSource(),n=this.audioContext.createBuffer(1,t.length,e);n.getChannelData(0).set(t),i.buffer=n,i.connect(this.audioContext.destination),i.start()}destroy(){this.pause(),this.progressSubject.complete()}}const tt=["floater"];function et(t,e){if(1&t){const t=l.Ob();l.Nb(0,"ion-fab",8),l.Vb("click",(function(){return l.hc(t),l.Xb().finish()})),l.Nb(1,"ion-fab-button"),l.Lb(2,"ion-icon",9),l.Mb(),l.Mb()}}function it(t,e){if(1&t){const t=l.Ob();l.Nb(0,"div",10),l.Vb("click",(function(){return l.hc(t),l.Xb().acceptLabelRecording()})),l.Lb(1,"fa-icon",7),l.Mb()}if(2&t){const t=l.Xb();l.zb(1),l.cc("icon",t.faCheck)}}const nt=function(t,e){return{recording:t,disabled:e}},st=function(t,e){return{playing:t,disabled:e}};var ot=function(t){return t[t.LOADING=1]="LOADING",t[t.READY=2]="READY",t[t.SELECTED=3]="SELECTED",t[t.RECORDING=4]="RECORDING",t[t.RECBUSY=5]="RECBUSY",t[t.REVIEWING=6]="REVIEWING",t[t.CONFIRMING=7]="CONFIRMING",t}({}),at=function(t){return t[t.READY=0]="READY",t[t.TOUCHING=1]="TOUCHING",t[t.SELECTED=2]="SELECTED",t}({});let rt=(()=>{class t{constructor(t,e,i,n,s,o){this.modalCtrl=t,this.popCtrl=e,this.tools=i,this.data=n,this.audio=s,this.change=o,this.faSquare=O,this.faPause=P,this.faPlay=M,this.faCheck=C,this.faMicrophone=x,this.timeLine=[],this.currentIndex=0,this.labelMark=-1,this.imageLabels={},this.recordedSegment=null}ngOnInit(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(console.log("describe session",this.session),this.changeState(ot.LOADING),this.session.igvTimeline&&(this.timeLine=this.session.igvTimeline),this.session.imageLabels){this.imageLabels=Object.assign({},this.session.imageLabels);for(let t=0;t<this.session.imageIds.length&&this.imageLabels.hasOwnProperty(this.session.imageIds[t]);++t)this.labelMark=t}yield this.initialiseAudio(),yield this.swiper.waitForStart(),this.cmt=new q(this.swiper,this.session.imageIds),this.changeState(ot.READY),this.cmt.activate(0),this.cmt.observe().subscribe(t=>{t===at.SELECTED?this.changeState(ot.SELECTED):t===at.TOUCHING&&(this.state!==ot.SELECTED&&this.state!==ot.REVIEWING||this.changeState(ot.READY))})}))}ngOnDestroy(){this.audioDataModel.destroy(),this.player.destroy()}initialiseAudio(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(this.audioContext=this.audio.getAudioContext(),this.audioDataModel=new B({audioContext:this.audioContext,sampleRate:16e3,channels:1}),this.player=new $({audioContext:this.audioContext}),this.session.primary){const t=yield this.data.getAudioFile(this.session.primary);yield this.player.loadFromBlob(t.file)}this.audioDataModel.getPlayProgress().subscribe(t=>{this.state===ot.REVIEWING&&-1===t&&this.changeState(ot.CONFIRMING)}),this.player.observeProgress().subscribe(t=>{console.log("progress",t),-1===t&&this.changeFlags({isPlaying:!1})}),this.microphone=new F({audioContext:this.audioContext}),yield this.microphone.connect()}))}getCurrentImageId(){return this.session.imageIds[this.currentIndex]}close(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(this.hasChanged()){const e=yield this.confirm("Quit and discard changes?",["Yep","Nah"],t);if(!e||"Nah"===e)return}this.modalCtrl.dismiss()}))}hasChanged(){return!1}confirm(t,e,i=null){return Object(r.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.popCtrl.create({component:y,componentProps:{text:t,options:e}});return yield this.tools.showPopover(i)}))}swiperMove(t){console.log("slide",t),this.currentIndex=t,this.cmt.activate(t)}changeState(t){t===ot.LOADING?this.flags={isRecording:!1,isReviewing:!1,isPlaying:!1,canPlay:!1,canSlide:!1,canAccept:!1,canReverse:!1,canPressRecord:!1,canFinish:!1}:t===ot.READY?(this.flags={isRecording:!1,isReviewing:!1,isPlaying:!1,canPlay:!0,canSlide:!0,canReverse:!1,canPressRecord:!1,canAccept:!1,canFinish:this.hasChanged()},this.cmt.enable()):t===ot.SELECTED?(this.flags={isRecording:!1,isReviewing:!1,isPlaying:!1,canPlay:!0,canSlide:!0,canReverse:!1,canAccept:!1,canPressRecord:!0,canFinish:this.hasChanged()},this.cmt.drawupdate("yellow"),this.cmt.enable()):t===ot.RECORDING?(this.flags={isRecording:!0,isReviewing:!1,isPlaying:!1,canPlay:!1,canSlide:!1,canReverse:!1,canAccept:!1,canPressRecord:!0,canFinish:this.hasChanged()},this.cmt.disable()):t===ot.RECBUSY?(this.flags={isRecording:!0,isReviewing:!1,isPlaying:!1,canPlay:!1,canSlide:!1,canReverse:!1,canAccept:!1,canPressRecord:!1,canFinish:this.hasChanged()},this.cmt.disable()):t===ot.REVIEWING?(this.flags={isRecording:!1,isReviewing:!0,isPlaying:!1,canPlay:!1,canSlide:!0,canReverse:!1,canAccept:!0,canPressRecord:!0,canFinish:this.hasChanged()},this.cmt.disable()):t===ot.CONFIRMING&&(this.flags={isRecording:!1,isReviewing:!1,isPlaying:!1,canPlay:!0,canSlide:!0,canReverse:!1,canAccept:!0,canPressRecord:!0,canFinish:this.hasChanged()}),this.state=t,this.change.markForCheck()}finish(){}recdown(t){t.preventDefault(),console.log("d down"),this.flags.canPressRecord&&!this.flags.isRecording&&(this.recordedSegment&&(this.audioDataModel.deleteFrom(this.recordedSegment.offset),this.recordedSegment=null),this.changeState(ot.RECORDING),this.microphone.record(),this.cmt.animate("red"))}recup(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){t.preventDefault(),console.log("d up"),this.state===ot.RECORDING&&(console.log("stopping"),this.changeState(ot.RECBUSY),this.cmt.stopanimate("red"),yield this.microphone.stop(),console.log("stopped"),this.recordedSegment=yield this.audioDataModel.addResample(this.microphone.getBuffer()),this.microphone.clear(),this.changeState(ot.REVIEWING),console.log("reviewing"),this.audioDataModel.playFromFrame(this.recordedSegment.offset),this.cmt.drawupdate("green"))}))}recmove(t){t.preventDefault()}play(){if(this.flags.canPlay)if(this.flags.isPlaying)this.player.pause(),this.changeFlags({isPlaying:!1});else{const t=this.session.igvTimeline[this.currentIndex];this.player.play(t.startMs/1e3,t.endMs/1e3),this.changeFlags({isPlaying:!0})}}acceptLabelRecording(){const t=this.cmt.savebox(),e=this.getCurrentImageId();e in this.imageLabels||(this.imageLabels[e]=[]),this.imageLabels[e].push({audio:{startFrame:this.recordedSegment.offset,endFrame:this.recordedSegment.offset+this.recordedSegment.frames-1},box:t}),console.log("labels",this.imageLabels),this.changeState(ot.READY)}changeFlags(t){const e=Object.assign({},this.flags);Object.assign(e,t),this.flags=e,this.change.markForCheck()}}return t.\u0275fac=function(e){return new(e||t)(l.Kb(n.x),l.Kb(n.z),l.Kb(h.a),l.Kb(Y.a),l.Kb(V),l.Kb(l.h))},t.\u0275cmp=l.Eb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){var i;1&t&&(l.sc(z,!0),l.sc(tt,!0)),2&t&&(l.fc(i=l.Wb())&&(e.swiper=i.first),l.fc(i=l.Wb())&&(e.floatingIcon=i.first))},inputs:{session:"session"},decls:8,vars:18,consts:[["slot","icon-only","name","close",1,"closebutton",3,"click"],[3,"images","enabled","reverse","selected","highwater","move"],["class","finishbutton","horizontal","center","vertical","bottom",3,"click",4,"ngIf"],["class","bigbutton accept ion-activatable",3,"click",4,"ngIf"],[1,"bigbutton","record","ion-activatable",3,"ngClass","touchstart","touchmove","touchend","touchcancel"],[3,"icon","spin"],[1,"bigbutton","play","ion-activatable",3,"ngClass","click"],[3,"icon"],["horizontal","center","vertical","bottom",1,"finishbutton",3,"click"],["name","checkmark"],[1,"bigbutton","accept","ion-activatable",3,"click"]],template:function(t,e){1&t&&(l.Nb(0,"ion-icon",0),l.Vb("click",(function(t){return e.close(t)})),l.Mb(),l.Nb(1,"app-swiper",1),l.Vb("move",(function(t){return e.swiperMove(t)})),l.Mb(),l.nc(2,et,3,0,"ion-fab",2),l.nc(3,it,2,1,"div",3),l.Nb(4,"div",4),l.Vb("touchstart",(function(t){return e.recdown(t)}))("touchmove",(function(t){return e.recmove(t)}))("touchend",(function(t){return e.recup(t)}))("touchcancel",(function(t){return e.recup(t)})),l.Lb(5,"fa-icon",5),l.Mb(),l.Nb(6,"div",6),l.Vb("click",(function(){return e.play()})),l.Lb(7,"fa-icon",7),l.Mb()),2&t&&(l.zb(1),l.cc("images",e.session.imageIds)("enabled",e.flags.canSlide)("reverse",e.flags.canReverse)("selected",e.currentIndex)("highwater",e.labelMark),l.zb(1),l.cc("ngIf",e.flags.canFinish),l.zb(1),l.cc("ngIf",e.flags.canAccept),l.zb(1),l.cc("ngClass",l.dc(12,nt,e.flags.isRecording,!e.flags.canPressRecord)),l.zb(1),l.cc("icon",e.faSquare)("spin",e.flags.isRecording),l.zb(1),l.cc("ngClass",l.dc(15,st,e.flags.isPlaying,!e.flags.canPlay)),l.zb(1),l.cc("icon",e.flags.isPlaying?e.faPause:e.faPlay))},directives:[n.k,z,s.k,s.i,G.a,n.h,n.i],styles:["div.bigbutton[_ngcontent-%COMP%]{width:100px;height:100px;position:absolute;bottom:5px;border-radius:50%;background-color:var(--ion-color-primary);display:flex;align-items:center;justify-content:center;box-shadow:0 3px 5px -1px rgba(0,0,0,.3)}div.bigbutton[_ngcontent-%COMP%]   fa-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary-contrast);font-size:28px}div.littlebutton[_ngcontent-%COMP%]{width:70px;height:70px;position:absolute;border-radius:50%;background-color:var(--ion-color-primary);display:flex;align-items:center;justify-content:center;box-shadow:0 3px 5px -1px rgba(0,0,0,.3)}div.littlebutton[_ngcontent-%COMP%]   fa-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary-contrast);font-size:18px}.bigbutton.accept[_ngcontent-%COMP%]{bottom:120px;right:5px}.bigbutton.record[_ngcontent-%COMP%]{right:5px}.bigbutton.play[_ngcontent-%COMP%]{left:5px}.bigbutton.play.playing[_ngcontent-%COMP%]{background-color:green}.bigbutton.record.recording[_ngcontent-%COMP%]{background-color:red}.bigbutton.disabled[_ngcontent-%COMP%]{background-color:var(--ion-color-primary-deselect);opacity:.5}.finishbutton[_ngcontent-%COMP%]{bottom:5px}.labelbutton[_ngcontent-%COMP%]{position:absolute;border-radius:50%;background-color:var(--ion-color-primary);width:60px;height:60px;display:flex;align-items:center;justify-content:center;transform:translate(-50%,-50%);z-index:10;-webkit-filter:drop-shadow(0 0 5px var(--ion-color-primary-contrast));filter:drop-shadow(0 0 5px var(--ion-color-primary-contrast))}.labelbutton[_ngcontent-%COMP%]   fa-icon[_ngcontent-%COMP%]{color:var(--ion-background-color);font-size:24px}.labelbutton.playing[_ngcontent-%COMP%]{background-color:green}.labelbutton.recording[_ngcontent-%COMP%]{background-color:red}@media (orientation:portrait){app-swiper[_ngcontent-%COMP%]{margin-top:35px}}"],changeDetection:0}),t})();const ct=["snippetel"];function ht(t,e){if(1&t&&(l.Nb(0,"div",5),l.Lb(1,"ion-icon",6),l.Mb()),2&t){const t=e.index,i=l.Xb();l.Bb("complete",i.session.stage>t),l.zb(1),l.cc("name",i.geticon(t))}}let lt=(()=>{class t{constructor(t,e,i){this.sesh=t,this.modalCtrl=e,this.tools=i,this.progIcons=["camera","mic-circle","help-circle","checkmark-circle"],this.openingmodal=!1,this.longpress=new l.n,this.activated=new Set}ngOnInit(){this.imageStyle=this.sesh.getImageStyleFromId(this.session.coverId)}ngAfterViewInit(){console.log("el",this.snippetElement),this.alloy=new K.a(this.snippetElement.nativeElement,{tap:()=>{this.click()},longTap:()=>{this.longpress.emit()}})}ngOnDestroy(){this.alloy.destroy()}geticon(t){let e=this.progIcons[t];return this.session.stage<=t&&(e=e+="-outline"),e}click(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(!this.openingmodal){if(this.openingmodal=!0,1===this.session.stage){const t=yield this.modalCtrl.create({component:Z,componentProps:{session:this.session}});yield this.tools.showModal(t)}else if(2===this.session.stage){const t=yield this.modalCtrl.create({component:rt,componentProps:{session:this.session}});yield this.tools.showModal(t)}this.openingmodal=!1}}))}}return t.\u0275fac=function(e){return new(e||t)(l.Kb(c.a),l.Kb(n.x),l.Kb(h.a))},t.\u0275cmp=l.Eb({type:t,selectors:[["app-kitchen-snippet"]],viewQuery:function(t,e){var i;1&t&&l.sc(ct,!0),2&t&&l.fc(i=l.Wb())&&(e.snippetElement=i.first)},inputs:{session:"session",setac:"setac"},outputs:{longpress:"longpress"},decls:6,vars:5,consts:[[1,"snippet"],["snippetel",""],[1,"photo"],[1,"progressbar"],["class","progressitem",3,"complete",4,"ngFor","ngForOf"],[1,"progressitem"],["icon-only","",3,"name"]],template:function(t,e){if(1&t&&(l.Nb(0,"div",0,1),l.Lb(2,"div",2),l.Yb(3,"async"),l.Nb(4,"div",3),l.nc(5,ht,2,3,"div",4),l.Mb(),l.Mb()),2&t){var i;const t=null==(i=l.Zb(3,3,e.imageStyle))?null:i.style;l.zb(2),l.mc("background-image",t,l.Db),l.zb(3),l.cc("ngForOf",e.progIcons)}},directives:[s.j,n.k],pipes:[s.b],styles:['.snippet[_ngcontent-%COMP%]{width:100%;height:120px;display:flex;flex-direction:row;padding:5px;--color-incomplete:var(--ion-color-primary);--color-complete:var(--ion-color-secondary);border-bottom:1px solid grey}.snippet[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%]{width:160px;border:1px solid rgba(0,0,0,.2);background-size:cover;background-position:50%;-webkit-filter:drop-shadow(-1px 1px 3px var(--ion-color-dark));filter:drop-shadow(-1px 1px 3px var(--ion-color-dark))}.snippet[_ngcontent-%COMP%]   .progressbar[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row}.snippet[_ngcontent-%COMP%]   .progressbar[_ngcontent-%COMP%]   .progressitem[_ngcontent-%COMP%]{width:25%;display:flex;align-items:center;justify-content:center;color:var(--ion-color-primary);position:relative;opacity:.6}.snippet[_ngcontent-%COMP%]   .progressbar[_ngcontent-%COMP%]   .progressitem[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{display:inline-block;font-size:36px}.snippet[_ngcontent-%COMP%]   .progressbar[_ngcontent-%COMP%]   .progressitem.complete[_ngcontent-%COMP%]{color:var(--ion-color-primary);opacity:1}.snippet[_ngcontent-%COMP%]   .progressbar[_ngcontent-%COMP%]   .progressitem.complete[_ngcontent-%COMP%]:not(:first-child):before, .snippet[_ngcontent-%COMP%]   .progressbar[_ngcontent-%COMP%]   .progressitem[_ngcontent-%COMP%]:not(.complete):not(:first-child):before{height:2px;background-color:var(--ion-color-primary);content:"";position:absolute;width:calc(100% - 26px);left:calc(-50% + 14px);z-index:-1}.snippet[_ngcontent-%COMP%]   .progressbar[_ngcontent-%COMP%]   .progressitem[_ngcontent-%COMP%]:not(.complete):not(:first-child):before{opacity:.8}.activated[_nghost-%COMP%]   .snippet[_ngcontent-%COMP%]{-webkit-filter:drop-shadow(0 0 5px red);filter:drop-shadow(0 0 5px red)}']}),t})();const dt=["fileinput"];function gt(t,e){if(1&t){const t=l.Ob();l.Nb(0,"app-kitchen-snippet",8),l.Vb("longpress",(function(){l.hc(t);const i=e.$implicit;return l.Xb().longpress(i.id)})),l.Mb()}if(2&t){const t=e.$implicit,i=l.Xb();l.Bb("activated",i.activated.has(t.id)),l.cc("session",t)}}function ut(t,e){if(1&t){const t=l.Ob();l.Nb(0,"ion-fab",9),l.Nb(1,"ion-fab-button",3),l.Vb("click",(function(e){return l.hc(t),l.Xb().openActionSheet(e)})),l.Lb(2,"ion-icon",10),l.Mb(),l.Mb()}}const pt=[{path:"",component:(()=>{class t{constructor(t,e,i,n,s){this.sessions=t,this.modalCtrl=e,this.tools=i,this.actionCtrl=n,this.popCtrl=s,this.activated=new Set,this.showMenu=!1,this.$sessionList=t.observeSessions()}handleFiles(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(t.preventDefault(),0===t.target.files.length)return;const e=yield this.modalCtrl.create({component:v,componentProps:{files:t.target.files}}),i=yield this.tools.showModal(e);i&&(yield this.sessions.createSession(i.photos,i.coverIndex))}))}clickNew(){this.inputElement.nativeElement.click()}longpress(t){this.activated.has(t)?this.activated.delete(t):this.activated.add(t),this.showMenu=Array.from(this.activated.values()).length>0}openActionSheet(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.actionCtrl.create({header:"Sessions",cssClass:"my-custom-class",buttons:[{text:"Delete",role:"destructive",icon:"trash",handler:()=>Object(r.__awaiter)(this,void 0,void 0,(function*(){console.log("Delete clicked");const e=this.activated.size,i=e>1?"s":"",n="Delete "+e.toString()+" session"+i+"?",s=yield this.confirm(n,["Delete","Cancel"],t);s&&"Cancel"!==s&&(console.log("deleting"),yield this.sessions.deleteSessions(Array.from(this.activated.values())),this.activated.clear(),this.showMenu=!1)}))},{text:"Cancel",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked"),this.activated.clear(),this.showMenu=!1}}]});yield e.present()}))}confirm(t,e,i=null){return Object(r.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.popCtrl.create({component:y,componentProps:{text:t,options:e}});return yield this.tools.showPopover(i)}))}}return t.\u0275fac=function(e){return new(e||t)(l.Kb(c.a),l.Kb(n.x),l.Kb(h.a),l.Kb(n.a),l.Kb(n.z))},t.\u0275cmp=l.Eb({type:t,selectors:[["app-kitchen"]],viewQuery:function(t,e){var i;1&t&&l.lc(dt,!0),2&t&&l.fc(i=l.Wb())&&(e.inputElement=i.first)},decls:9,vars:4,consts:[[1,"scroller"],[3,"session","activated","longpress",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed",1,"foo"],[3,"click"],["name","add-outline"],["vertical","bottom","horizontal","center","slot","fixed","class","foo",4,"ngIf"],["multiple","","type","file","name","name","accept","image/*",2,"display","none",3,"change"],["fileinput",""],[3,"session","longpress"],["vertical","bottom","horizontal","center","slot","fixed",1,"foo"],["name","ellipsis-vertical"]],template:function(t,e){1&t&&(l.Nb(0,"div",0),l.nc(1,gt,1,3,"app-kitchen-snippet",1),l.Yb(2,"async"),l.Mb(),l.Nb(3,"ion-fab",2),l.Nb(4,"ion-fab-button",3),l.Vb("click",(function(){return e.clickNew()})),l.Lb(5,"ion-icon",4),l.Mb(),l.Mb(),l.nc(6,ut,3,0,"ion-fab",5),l.Nb(7,"input",6,7),l.Vb("change",(function(t){return e.handleFiles(t)})),l.Mb()),2&t&&(l.zb(1),l.cc("ngForOf",l.Zb(2,2,e.$sessionList)),l.zb(5),l.cc("ngIf",e.showMenu))},directives:[s.j,n.h,n.i,n.k,s.k,lt],pipes:[s.b],styles:[".scroller[_ngcontent-%COMP%]{-webkit-overflow-scrolling:touch;-ms-overflow-style:none;scrollbar-width:none;overflow-y:scroll;color:#000;margin-bottom:30px}.scroller[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}ion-fab-button[_ngcontent-%COMP%]{--color:var(--ion-background-color)}"]}),t})()}];let mt=(()=>{class t{}return t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({factory:function(e){return new(e||t)},imports:[[a.i.forChild(pt)],a.i]}),t})();var bt=i("j1ZV");let ft=(()=>{class t{}return t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({factory:function(e){return new(e||t)},imports:[[n.v,s.c,o.a,mt,bt.a]]}),t})()},pooC:function(t,e,i){"use strict";e.Deferred=function(){function t(){var t=this;this.resolve=function(e){t._resolve(e)},this.reject=function(e){t._reject(e)},this._promise=new Promise((function(e,i){t._resolve=e,t._reject=i}))}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),t}()}}]);